<!doctype html>
<html>
    <head>
        <title>Socket.IO chat</title>
        <style>
            body { font: 13px Helvetica, Arial; display: flex; height: 90vh; }
            
            .mainWrapper {width: 80%; height: 90%; top: 0; position: fixed; left: 2px;}
            .sideBarWrapper {width: 16%; position: fixed; right: 2px;}
            
            .topBox {padding: 3px; position: relative; top: 0; width: 100%;}
            .bottomBox {padding: 3px; position: fixed; bottom: 0; width: 81%;}
            input { border: 1; padding: 10px; width: 90%;}
            button { background: rgb(130, 224, 255); border: none; padding: 10px; }
            
            .userListContainer { padding: 5px 5px; background-color: #d5d5ff; top: 0px;}
            .userList li {word-wrap: break-word;}
            .userList li:nth-child(odd) { background: #eee; }
            
            #messages { list-style-type: none; margin-left: 0; padding-left: 1%; padding-bottom: 1%; width: 95%; height: 90%; overflow: auto;}
            #messages li { padding: 5px 1px; word-wrap: break-word;}
            #messages li:nth-child(odd) { background: #eee; }
        </style>
    </head>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
		$(function () {
			var socket = io();
            
			if (getCookie('socChat_name') != null) {
				socket.emit('name load', getCookie('socChat_name'));
			}
            
			$('#messageForm').submit(function() {
				socket.emit('chat message', $('#m').val());
				$('#m').val('');
				return false;
			});
            
			$('#nameForm').submit(function() {
				socket.emit('name change', $('#n').val());
				document.cookie = "socChat_name=" + $('#n').val() + ";expires=Wed, 1 Jan 2031 ;";
				$('#n').val('');
				return false;
			});
            
			socket.on('chat message', function(msg) {
				$('#messages').append($('<li>').text(msg));
                var el = document.getElementById("messages");
                el.scrollTop = el.scrollHeight;
			});
            
			socket.on('user leave', function(id) {
				$('#' + id).remove();
			});
			
			socket.on('populate list', function(people) { 
				
				var list = Object.keys(people);
				
				for (var i = 0; i < list.length; i++) {
					var id = list[i];
					$('#userList').append('<li id=\"' + id + '\">' + id);
				}
			});
            
			socket.on('populate messages', function(history) {
                
				for (var i = 0; i < history.length; i++) {
				    $('#messages').append($('<li>').text(history[i]));
                }
			});
		});

		function getCookie(name) {
			var value = "; " + document.cookie;
			var parts = value.split("; " + name + "=");
			if (parts.length == 2) return parts.pop().split(";").shift();
		}
	</script>
    <body>
        <div class="mainWrapper">
            <div class="topBox">
                <form action="" id="nameForm">
                    <input id="n" autocomplete="off" /><button>Set name</button>
                </form>
            </div>
            <ul id="messages"></ul>
            <div class="bottomBox">
                <form action="" id="messageForm">
                    <input id="m" autocomplete="off" /><button>Send</button>
                </form>
            </div>
        </div>
        
        <div class="sideBarWrapper">
            <div class="userListContainer">
                <h3>Users</h3>
                <ul id="userList">
                </ul>
            </div>
        </div>
            
    </body>
</html>